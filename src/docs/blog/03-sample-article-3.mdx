# 헥토파이낸셜 결과통보 URL 설정 가이드

Server-to-Server 결과 통보를 위한 notiUrl 설정 방법을 알아보세요.

## 결과통보 URL이란?

`notiUrl`은 헥토파이낸셜 서버에서 귀하의 서버로 결제 결과를 자동으로 통보하는 URL입니다. 실제 DB 처리는 이곳에서 이루어집니다.

## notiUrl 설정

### 기본 설정
```javascript
SETTLE_PG.pay({
    env: "https://tbnpg.settlebank.co.kr",
    mchtId: "nxca_jt_il",
    method: "card",
    trdDt: "20231215",
    trdTm: "143022",
    mchtTrdNo: "ORDER20231215143022",
    mchtName: "테스트상점",
    pmtPrdtNm: "테스트상품",
    trdAmt: "1000",
    notiUrl: "https://yoursite.com/notify", // 결과통보 URL
    nextUrl: "https://yoursite.com/success",
    cancUrl: "https://yoursite.com/cancel",
    pktHash: "생성된해시값"
}, function(response) {
    console.log(response);
});
```

## 결과통보 처리

### 🔔 notiUrl 특징
- **Server-to-Server** 결과 통보
- **실제 DB 처리**는 여기서!
- 결제 완료 후 자동으로 호출됩니다

### 해시 검증 필수
```javascript
app.post('/notify', (req, res) => {
    const receivedData = req.body;
    
    // 🔒 중요: 해시 검증 필수
    if (!verifyHash(receivedData)) {
        return res.status(400).send('Invalid hash');
    }
    
    // 검증 완료 후 실제 서비스 제공
    processPaymentResult(receivedData);
    
    res.status(200).send('OK');
});
```

## 보안 주의사항

> ⚠️ **중요**: notiUrl로 전송되는 결과 데이터는 **반드시 해시 검증**을 거쳐야 합니다. 검증이 완료된 후에만 실제 서비스를 제공하세요.

### 해시 검증 방법
1. 전송받은 데이터의 해시값 확인
2. 예상 해시값과 비교
3. 일치하는 경우에만 결제 처리 진행

## 실제 구현 예시

```javascript
// 결제 요청 시 notiUrl 포함
const paymentData = {
    mchtId: "your_merchant_id",
    mchtTrdNo: "ORDER_" + Date.now(),
    trdAmt: "10000",
    mchtCustNm: "홍길동",
    notiUrl: "https://yoursite.com/notify"
};

// notiUrl 엔드포인트에서 처리
app.post('/notify', (req, res) => {
    const paymentResult = req.body;
    
    // 1. 해시 검증
    if (verifyPaymentHash(paymentResult)) {
        // 2. 결제 결과 처리
        updateOrderStatus(paymentResult);
        
        // 3. 성공 응답
        res.status(200).send('OK');
    } else {
        // 해시 검증 실패
        res.status(400).send('Invalid request');
    }
});
```

---

**작성일**: 2025-09-05  
**카테고리**: 기술  
**읽기 시간**: 6분
